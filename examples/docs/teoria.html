<!DOCTYPE html>  <html> <head>   <title>teoria.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="teoria.html">                 teoria.js               </a>                                           <a class="source" href="teoriachord.html">                 teoriachord.js               </a>                                           <a class="source" href="teorianamespaces.html">                 teorianamespaces.js               </a>                                           <a class="source" href="teorianote.html">                 teorianote.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               teoria.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Music Theory for JavaScript</h1>

<p>Teoria is a simple framework for doing music theory related stuff in JavaScript.
It's dead-simple and consists of very dynamic objects that can interact with eachother in many ways.</p>

<p>At the left of the screen, you can see the full source of <code>teoria.js</code>. It will not always be the updated version, but I'll try to 
keep it as up-to-date as possible.
This pages is mostly the frontpage. You can, in the upper right corner of the screen choose between some different files.
These files are Anotated Source files, which are very describing, and should guide you on the right way to use this framework.</p>

<p>Good luck!</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">teoria</span> <span class="o">=</span> <span class="p">{};</span>
  
  <span class="kd">var</span> <span class="nx">NOTES</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;c&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">0</span>
      <span class="p">},</span>
      <span class="s1">&#39;d&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="s1">&#39;e&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">2</span>
      <span class="p">},</span>
      <span class="s1">&#39;f&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">3</span>
      <span class="p">},</span>
      <span class="s1">&#39;g&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">4</span>
      <span class="p">},</span>
      <span class="s1">&#39;a&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">5</span>
      <span class="p">},</span>
      <span class="s1">&#39;b&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">6</span>
      <span class="p">},</span>
      <span class="s1">&#39;h&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="nx">distance</span><span class="o">:</span> <span class="mi">11</span><span class="p">,</span>
        <span class="nx">index</span><span class="o">:</span> <span class="mi">6</span>
      <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">NOTES_INDEX</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">];</span>
  
  <span class="kd">var</span> <span class="nx">DURATIONS</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;0.25&#39;</span><span class="o">:</span> <span class="s1">&#39;longa&#39;</span><span class="p">,</span>
      <span class="s1">&#39;0.5&#39;</span><span class="o">:</span> <span class="s1">&#39;breve&#39;</span><span class="p">,</span>
      <span class="s1">&#39;1&#39;</span><span class="o">:</span> <span class="s1">&#39;whole&#39;</span><span class="p">,</span>
      <span class="s1">&#39;2&#39;</span><span class="o">:</span> <span class="s1">&#39;half&#39;</span><span class="p">,</span>
      <span class="s1">&#39;4&#39;</span><span class="o">:</span> <span class="s1">&#39;quarter&#39;</span><span class="p">,</span>
      <span class="s1">&#39;8&#39;</span><span class="o">:</span> <span class="s1">&#39;eighth&#39;</span><span class="p">,</span>
      <span class="s1">&#39;16&#39;</span><span class="o">:</span> <span class="s1">&#39;sixteenth&#39;</span><span class="p">,</span>
      <span class="s1">&#39;32&#39;</span><span class="o">:</span> <span class="s1">&#39;thirty-second&#39;</span><span class="p">,</span>
      <span class="s1">&#39;64&#39;</span><span class="o">:</span> <span class="s1">&#39;sixty-fourth&#39;</span><span class="p">,</span>
      <span class="s1">&#39;128&#39;</span><span class="o">:</span> <span class="s1">&#39;hundred-twenty-eighth&#39;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">INTERVALS</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;unison&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;second&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">1</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;third&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">3</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;fourth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">5</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;fifth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">7</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;sixth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">8</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;seventh&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">10</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;octave&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">12</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;ninth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">13</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;tenth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">15</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;eleventh&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">17</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;twelfth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">19</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;thirteenth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">20</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;fourteenth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">22</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;fifteenth&#39;</span><span class="p">,</span>
    <span class="nx">quality</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
    <span class="nx">size</span><span class="o">:</span> <span class="mi">24</span>
  <span class="p">}];</span>
  
  <span class="kd">var</span> <span class="nx">INTERVAL_INDEX</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;unison&#39;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;third&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;fourth&#39;</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;fifth&#39;</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;sixth&#39;</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;seventh&#39;</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;octave&#39;</span><span class="o">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;ninth&#39;</span><span class="o">:</span><span class="mi">8</span><span class="p">,</span>
                        <span class="s1">&#39;tenth&#39;</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span><span class="s1">&#39;eleventh&#39;</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;twelfth&#39;</span><span class="o">:</span><span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;thirteenth&#39;</span><span class="o">:</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;fourteenth&#39;</span><span class="o">:</span><span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;fifteenth&#39;</span><span class="o">:</span><span class="mi">14</span><span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">QUALITY_STRING</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;P&#39;</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span> 
      <span class="s1">&#39;M&#39;</span><span class="o">:</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> 
      <span class="s1">&#39;m&#39;</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> 
      <span class="s1">&#39;A&#39;</span><span class="o">:</span> <span class="s1">&#39;augmented&#39;</span><span class="p">,</span> 
      <span class="s1">&#39;d&#39;</span><span class="o">:</span> <span class="s1">&#39;diminished&#39;</span><span class="p">,</span>
      
      <span class="s1">&#39;perf&#39;</span><span class="o">:</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span>
      <span class="s1">&#39;maj&#39;</span><span class="o">:</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span>
      <span class="s1">&#39;min&#39;</span><span class="o">:</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span>
      <span class="s1">&#39;aug&#39;</span><span class="o">:</span> <span class="s1">&#39;augmented&#39;</span><span class="p">,</span>
      <span class="s1">&#39;dim&#39;</span><span class="o">:</span> <span class="s1">&#39;diminished&#39;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">QUALITY_TO_SIMPLE</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;perfect&#39;</span><span class="o">:</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span>
      <span class="s1">&#39;major&#39;</span><span class="o">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
      <span class="s1">&#39;minor&#39;</span><span class="o">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
      <span class="s1">&#39;augmented&#39;</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
      <span class="s1">&#39;diminished&#39;</span><span class="o">:</span> <span class="s1">&#39;d&#39;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">INTERVAL_INVERSION</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;P&#39;</span><span class="o">:</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span>
      <span class="s1">&#39;M&#39;</span><span class="o">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
      <span class="s1">&#39;m&#39;</span><span class="o">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
      <span class="s1">&#39;A&#39;</span><span class="o">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
      <span class="s1">&#39;d&#39;</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">ALTERATIONS</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">perfect</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;diminished&#39;</span><span class="p">,</span> <span class="s1">&#39;perfect&#39;</span><span class="p">,</span> <span class="s1">&#39;augmented&#39;</span><span class="p">],</span>
      <span class="nx">minor</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;diminished&#39;</span><span class="p">,</span> <span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;augmented&#39;</span><span class="p">]</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">CHORDS</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;major&#39;</span><span class="o">:</span>            <span class="p">[</span><span class="s1">&#39;M3&#39;</span><span class="p">,</span> <span class="s1">&#39;P5&#39;</span><span class="p">],</span>
      <span class="s1">&#39;minor&#39;</span><span class="o">:</span>            <span class="p">[</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;P5&#39;</span><span class="p">],</span>
      <span class="s1">&#39;augmented&#39;</span><span class="o">:</span>        <span class="p">[</span><span class="s1">&#39;M3&#39;</span><span class="p">,</span> <span class="s1">&#39;A5&#39;</span><span class="p">],</span>
      <span class="s1">&#39;diminished&#39;</span><span class="o">:</span>       <span class="p">[</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;d5&#39;</span><span class="p">],</span>
      <span class="s1">&#39;sus2&#39;</span><span class="o">:</span>             <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;P5&#39;</span><span class="p">],</span>
      <span class="s1">&#39;sus4&#39;</span><span class="o">:</span>             <span class="p">[</span><span class="s1">&#39;P4&#39;</span><span class="p">,</span> <span class="s1">&#39;P5&#39;</span><span class="p">],</span>
      <span class="s1">&#39;power&#39;</span><span class="o">:</span>            <span class="p">[</span><span class="s1">&#39;P5&#39;</span><span class="p">]</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">CHORDLOOKUP</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;major&#39;</span><span class="o">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
      <span class="s1">&#39;minor&#39;</span><span class="o">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
      <span class="s1">&#39;augmented&#39;</span><span class="o">:</span> <span class="s1">&#39;aug&#39;</span><span class="p">,</span>
      <span class="s1">&#39;diminished&#39;</span><span class="o">:</span> <span class="s1">&#39;dim&#39;</span><span class="p">,</span>
      <span class="s1">&#39;power&#39;</span><span class="o">:</span> <span class="s1">&#39;5&#39;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">ACCIDENTALTOSIGN</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;-2&#39;</span><span class="o">:</span> <span class="s1">&#39;bb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;-1&#39;</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
    <span class="s1">&#39;0&#39;</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;1&#39;</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span>
    <span class="s1">&#39;2&#39;</span><span class="o">:</span> <span class="s1">&#39;x&#39;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">SIGNTOACCIDENTAL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bb&#39;</span><span class="o">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;#&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;x&#39;</span><span class="o">:</span> <span class="mi">2</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * getDistance, returns the distance in semitones between two notes</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">getDistance</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">from</span> <span class="o">=</span> <span class="nx">NOTES</span><span class="p">[</span><span class="nx">from</span><span class="p">];</span>
    <span class="nx">to</span> <span class="o">=</span> <span class="nx">NOTES</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">distance</span> <span class="o">&gt;</span> <span class="nx">to</span><span class="p">.</span><span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">distance</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span><span class="o">-</span><span class="nx">from</span><span class="p">.</span><span class="nx">distance</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">to</span><span class="p">.</span><span class="nx">distance</span><span class="o">-</span><span class="nx">from</span><span class="p">.</span><span class="nx">distance</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">pad</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">ch</span><span class="p">,</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(;</span> <span class="nx">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">len</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">str</span> <span class="o">+=</span> <span class="nx">ch</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="cm">/**</span>
<span class="cm">   * TeoriaNote - teoria.note - the note object</span>
<span class="cm">   * </span>
<span class="cm">   * This object is the representation of a note.</span>
<span class="cm">   * The constructor must be called with a name, and optionally a value argument.</span>
<span class="cm">   * The first parameter (name) can be specified in either scientific notation (name+accidentals+octave). Fx:</span>
<span class="cm">   *    A4 - Cb3 - D#8 - Hbb - etc.</span>
<span class="cm">   * Or in the Helmholtz notation:</span>
<span class="cm">   *    ,,C - F#&#39;&#39; - d - Eb - etc.</span>
<span class="cm">   */</span>
  <span class="kd">function</span> <span class="nx">TeoriaNote</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">name</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">duration</span> <span class="o">||</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span> <span class="o">=</span> <span class="p">{</span><span class="nx">value</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">sign</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">};</span>
    <span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^([abcdefgh])(x|#|bb|b?)(-?\d*)/i</span><span class="p">);</span> <span class="c1">// 1 = note, 2 = accidentals, 3 = octave</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">parser</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span> <span class="o">===</span> <span class="nx">parser</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">parser</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Scientific Notation</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">parser</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        
      <span class="k">if</span><span class="p">(</span><span class="nx">parser</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">SIGNTOACCIDENTAL</span><span class="p">[</span><span class="nx">parser</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Helmholtz Notation</span>
      <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\u2032/g</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\u0375/g</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^(,*)([abcdefgh])(x|#|bb|b?)([,\&#39;]*)$/i</span><span class="p">);</span> <span class="c1">// 1 = pre, 2 = note, 3 = accidentals, 4 = pro</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">info</span> <span class="o">||</span> <span class="nx">info</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">5</span> <span class="o">||</span> <span class="nx">name</span> <span class="o">!==</span> <span class="nx">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid note format&quot;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">info</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Only note name</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">=</span> <span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">===</span> <span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">info</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Pre</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">===</span> <span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// If lower-case</span>
          <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid note format. Format must respect the Helmholtz notation.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
          
        <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">info</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">info</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Pro       </span>
        <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^&#39;+$/</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// Up</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">===</span> <span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">toUpperCase</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// If upper-case</span>
            <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid note format. Format must respect the Helmholtz notation&quot;</span><span class="p">);</span>
          <span class="p">}</span>
          
          <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="nx">info</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^,+$/</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">===</span> <span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// If lower-case</span>
            <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid note format. Format must respect the Helmholtz notation&quot;</span><span class="p">);</span>
          <span class="p">}</span>
          
          <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">info</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid characters after note name.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid note format&quot;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">info</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">=</span> <span class="nx">info</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">SIGNTOACCIDENTAL</span><span class="p">[</span><span class="nx">info</span><span class="p">[</span><span class="mi">3</span><span class="p">]];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">TeoriaNote</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
      <span class="cm">/**</span>
<span class="cm">       * Returns the key number of the note</span>
<span class="cm">       */</span>
      <span class="nx">key</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">whitenotes</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">whitenotes</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">octave</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">NOTES</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">distance</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">octave</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="nx">NOTES</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">distance</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span> 
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Calculates and returns the frequency of the note, with an optional concert pitch (def. 440)</span>
<span class="cm">       */</span>
      <span class="nx">fq</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">concertPitch</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">concertPitch</span> <span class="o">=</span> <span class="nx">concertPitch</span> <span class="o">||</span> <span class="mi">440</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">concertPitch</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">()</span><span class="o">-</span><span class="mi">49</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Sugar function for teoria.scale.list(note, scale[, simple])</span>
<span class="cm">       */</span>
      <span class="nx">scale</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scale</span><span class="p">,</span> <span class="nx">simple</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">teoria</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">list</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">simple</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Sugar function for teoria.interval(note, interval[, direction])</span>
<span class="cm">       */</span>
      <span class="nx">interval</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">interval</span><span class="p">,</span> <span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">interval</span><span class="p">,</span> <span class="nx">direction</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Returns a TeoriaChord object with this note as root</span>
<span class="cm">       */</span>
      <span class="nx">chord</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chord</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">chord</span> <span class="o">=</span> <span class="nx">chord</span> <span class="o">||</span> <span class="s1">&#39;major&#39;</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">chord</span> <span class="k">in</span> <span class="nx">CHORDLOOKUP</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">chord</span> <span class="o">=</span> <span class="nx">CHORDLOOKUP</span><span class="p">[</span><span class="nx">chord</span><span class="p">];</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="k">new</span> <span class="nx">TeoriaChord</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">chord</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Returns the Helmholtz notation form of the note (fx ,,C d&#39; F# g#&#39;&#39;)</span>
<span class="cm">       */</span>
      <span class="nx">helmholtz</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">padding</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">padding</span> <span class="o">=</span> <span class="nx">pad</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">octave</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">padding</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">padding</span> <span class="o">=</span> <span class="nx">pad</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">octave</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">name</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">+</span> <span class="nx">padding</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Returns the scientific notation form of the note (fx E4, Bb3, C#7 etc.)</span>
<span class="cm">       */</span>
      <span class="nx">scientific</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">+</span> <span class="p">((</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">:</span>  <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Returns notes that are enharmonic with this note.</span>
<span class="cm">       */</span>
      <span class="nx">enharmonics</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">enharmonics</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">key</span><span class="p">(),</span> <span class="nx">upper</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">),</span> <span class="nx">lower</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">upperKey</span> <span class="o">=</span> <span class="nx">upper</span><span class="p">.</span><span class="nx">key</span><span class="p">()</span> <span class="o">-</span> <span class="nx">upper</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">lowerKey</span> <span class="o">=</span> <span class="nx">lower</span><span class="p">.</span><span class="nx">key</span><span class="p">()</span> <span class="o">-</span> <span class="nx">lower</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">diff</span> <span class="o">=</span> <span class="nx">key</span> <span class="o">-</span> <span class="nx">upperKey</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">diff</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">diff</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">upper</span><span class="p">.</span><span class="nx">accidental</span> <span class="o">=</span> <span class="p">{</span><span class="nx">value</span><span class="o">:</span> <span class="nx">diff</span><span class="p">,</span> <span class="nx">sign</span><span class="o">:</span> <span class="nx">ACCIDENTALTOSIGN</span><span class="p">[</span><span class="nx">diff</span><span class="p">]};</span>
          <span class="nx">enharmonics</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">upper</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">diff</span> <span class="o">=</span> <span class="nx">key</span> <span class="o">-</span> <span class="nx">lowerKey</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">diff</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">diff</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">lower</span><span class="p">.</span><span class="nx">accidental</span> <span class="o">=</span> <span class="p">{</span><span class="nx">value</span><span class="o">:</span> <span class="nx">diff</span><span class="p">,</span> <span class="nx">sign</span><span class="o">:</span> <span class="nx">ACCIDENTALTOSIGN</span><span class="p">[</span><span class="nx">diff</span><span class="p">]};</span>
          <span class="nx">enharmonics</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">lower</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="nx">enharmonics</span><span class="p">;</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Returns the name of the value, such as &#39;whole&#39;, &#39;quarter&#39;, &#39;sixteenth&#39; etc.</span>
<span class="cm">       */</span>
      <span class="nx">valueName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">DURATIONS</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">duration</span><span class="p">];</span>
      <span class="p">},</span>
      
      <span class="cm">/**</span>
<span class="cm">       * Returns the name of the note, with an optional dipsplay of octave number</span>
<span class="cm">       */</span>
      <span class="nx">toString</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dontShow</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dontShow</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">dontShow</span> <span class="o">===</span> <span class="s1">&#39;boolean&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">dontShow</span> <span class="o">:</span> <span class="p">((</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">+</span> <span class="p">((</span><span class="o">!</span><span class="nx">dontShow</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">octave</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="kd">function</span> <span class="nx">TeoriaChord</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">root</span> <span class="k">instanceof</span> <span class="nx">TeoriaNote</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">root</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">+</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">notes</span> <span class="o">=</span> <span class="p">[</span><span class="nx">root</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">=</span> <span class="s1">&#39;major&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;major&#39;</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">strQuality</span><span class="p">,</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">seventh</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">parsing</span> <span class="o">=</span> <span class="s1">&#39;quality&#39;</span><span class="p">,</span>
        <span class="nx">sharp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">flat</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">five</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">while</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39; &#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;(&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="nx">name</span><span class="p">[</span><span class="o">++</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="nx">code</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="nx">strQuality</span> <span class="o">=</span> <span class="p">((</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nx">length</span><span class="p">)</span> <span class="o">?</span> <span class="nx">name</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span><span class="nx">parsing</span> <span class="o">===</span> <span class="s1">&#39;quality&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">strQuality</span> <span class="o">===</span> <span class="s1">&#39;maj&#39;</span> <span class="o">||</span> <span class="nx">code</span> <span class="o">===</span> <span class="mi">916</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Maj7 chord</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;major&#39;</span><span class="p">;</span>
          <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;M7&#39;</span><span class="p">);</span> <span class="c1">// Maj7</span>
          <span class="nx">seventh</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">if</span><span class="p">((</span><span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;7&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">916</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;7&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">i</span><span class="o">++</span><span class="p">;</span> <span class="c1">// Jump over &#39;7&#39;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;m&#39;</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;-&#39;</span> <span class="o">||</span> <span class="nx">strQuality</span> <span class="o">===</span> <span class="s1">&#39;min&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;minor&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">111</span> <span class="o">||</span> <span class="nx">code</span> <span class="o">===</span> <span class="mi">176</span> <span class="o">||</span> <span class="nx">strQuality</span> <span class="o">===</span> <span class="s1">&#39;dim&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Diminished</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">=</span> <span class="s1">&#39;minor&#39;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;diminished&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;+&#39;</span> <span class="o">||</span> <span class="nx">strQuality</span> <span class="o">===</span> <span class="s1">&#39;aug&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">=</span> <span class="s1">&#39;major&#39;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;augmented&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">216</span> <span class="o">||</span> <span class="nx">code</span> <span class="o">===</span> <span class="mi">248</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Half-diminished</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">=</span> <span class="s1">&#39;minor&#39;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;diminished&#39;</span><span class="p">;</span>
          <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;m7&#39;</span><span class="p">);</span> <span class="c1">// Minor 7</span>
          <span class="nx">seventh</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">strQuality</span> <span class="o">===</span> <span class="s1">&#39;sus&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">=</span> <span class="s1">&#39;sus&#39;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;sus2&#39;</span> <span class="o">:</span> <span class="s1">&#39;sus4&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;5&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">i</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nx">strQuality</span> <span class="k">in</span> <span class="nx">QUALITY_STRING</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">parsing</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">sharp</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">flat</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;5&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">sharp</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">five</span> <span class="o">=</span> <span class="s1">&#39;A5&#39;</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">===</span> <span class="s1">&#39;major&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;augmented&#39;</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">flat</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">five</span> <span class="o">=</span> <span class="s1">&#39;d5&#39;</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">===</span> <span class="s1">&#39;minor&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;diminished&#39;</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="nx">flat</span> <span class="o">=</span> <span class="nx">sharp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;6&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;M6&#39;</span><span class="p">);</span>
          <span class="nx">flat</span> <span class="o">=</span> <span class="nx">sharp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;7&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;diminished&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;d7&#39;</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;m7&#39;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">seventh</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">flat</span> <span class="o">=</span> <span class="nx">sharp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">seventh</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;m7&#39;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">flat</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;m9&#39;</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">sharp</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;A9&#39;</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;M9&#39;</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">flat</span> <span class="o">=</span> <span class="nx">sharp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">=</span> <span class="nx">name</span><span class="p">[</span><span class="o">++</span><span class="nx">i</span><span class="p">];</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">flat</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;d11&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">sharp</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;A11&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;P11&#39;</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;3&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">flat</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;m13&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">sharp</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;A13&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">extensions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;M13&#39;</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="nx">flat</span> <span class="o">=</span> <span class="nx">sharp</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Unexpected character: &#39;&quot;</span><span class="o">+</span><span class="nx">c</span><span class="o">+</span><span class="s2">&quot;&#39; in chord name&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> 
    <span class="p">}</span>
    
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">xLength</span> <span class="o">=</span> <span class="nx">CHORDS</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">xLength</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">CHORDS</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">][</span><span class="nx">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;5&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">five</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">five</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">CHORDS</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">][</span><span class="nx">x</span><span class="p">]));</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">for</span><span class="p">(</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">xLength</span> <span class="o">=</span> <span class="nx">extensions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">xLength</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">extensions</span><span class="p">[</span><span class="nx">x</span><span class="p">]));</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">TeoriaChord</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dominant</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">additional</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">additional</span> <span class="o">=</span> <span class="nx">additional</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">TeoriaChord</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="s1">&#39;P5&#39;</span><span class="p">),</span> <span class="nx">additional</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="nx">TeoriaChord</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">subdominant</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">additional</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">additional</span> <span class="o">=</span> <span class="nx">additional</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">TeoriaChord</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="s1">&#39;P4&#39;</span><span class="p">),</span> <span class="nx">additional</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="nx">TeoriaChord</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parallel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">additional</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">additional</span> <span class="o">=</span> <span class="nx">additional</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">chordType</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;triad&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">===</span> <span class="s1">&#39;diminished&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">===</span> <span class="s1">&#39;augmented&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Only major/minor triads have parallel chords&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">quality</span> <span class="o">===</span> <span class="s1">&#39;major&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">TeoriaChord</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">TeoriaChord</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;up&#39;</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="nx">TeoriaChord</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">chordType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// In need of better name</span>
    <span class="kd">var</span> <span class="nx">is</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">interval</span><span class="p">,</span> <span class="nx">has</span><span class="p">,</span> <span class="nx">invert</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;dyad&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">has</span> <span class="o">=</span> <span class="p">{</span><span class="nx">unison</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">third</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">fifth</span><span class="o">:</span> <span class="kc">false</span><span class="p">};</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">interval</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="nx">invert</span> <span class="o">=</span> <span class="nx">INTERVALS</span><span class="p">[</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">invert</span><span class="p">(</span><span class="nx">interval</span><span class="p">.</span><span class="nx">simple</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">interval</span><span class="p">.</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">has</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">has</span><span class="p">[</span><span class="nx">interval</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">invert</span><span class="p">.</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">has</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">has</span><span class="p">[</span><span class="nx">invert</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="p">(</span><span class="nx">has</span><span class="p">.</span><span class="nx">unison</span> <span class="o">&amp;&amp;</span> <span class="nx">has</span><span class="p">.</span><span class="nx">third</span> <span class="o">&amp;&amp;</span> <span class="nx">has</span><span class="p">.</span><span class="nx">fifth</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;triad&#39;</span> <span class="o">:</span> <span class="s1">&#39;trichord&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">has</span> <span class="o">=</span> <span class="p">{</span><span class="nx">unison</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">third</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">fifth</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">seventh</span><span class="o">:</span> <span class="kc">false</span><span class="p">};</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">interval</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="nx">invert</span> <span class="o">=</span> <span class="nx">INTERVALS</span><span class="p">[</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">invert</span><span class="p">(</span><span class="nx">interval</span><span class="p">.</span><span class="nx">simple</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">interval</span><span class="p">.</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">has</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">has</span><span class="p">[</span><span class="nx">interval</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">invert</span><span class="p">.</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">has</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">has</span><span class="p">[</span><span class="nx">invert</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">if</span><span class="p">(</span><span class="nx">has</span><span class="p">.</span><span class="nx">unison</span> <span class="o">&amp;&amp;</span> <span class="nx">has</span><span class="p">.</span><span class="nx">third</span> <span class="o">&amp;&amp;</span> <span class="nx">has</span><span class="p">.</span><span class="nx">fifth</span> <span class="o">&amp;&amp;</span> <span class="nx">has</span><span class="p">.</span><span class="nx">seventh</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;tetrad&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> 
    
    <span class="k">return</span> <span class="s1">&#39;unknown&#39;</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="nx">TeoriaChord</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">teoria</span><span class="p">.</span><span class="nx">note</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">TeoriaNote</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">));</span>
  <span class="p">};</span>
  
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">fromKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fq</span> <span class="o">=</span> <span class="mi">440</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="nx">key</span><span class="o">-</span><span class="mi">49</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">teoria</span><span class="p">.</span><span class="nx">frequency</span><span class="p">.</span><span class="nx">note</span><span class="p">(</span><span class="nx">fq</span><span class="p">).</span><span class="nx">note</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="cm">/**</span>
<span class="cm">   * teoria.chord contains Chord functionality</span>
<span class="cm">   */</span>
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">chord</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">root</span><span class="p">;</span>
    <span class="nx">root</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^([abcdefgh])(x|#|bb|b?)/i</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">root</span> <span class="o">&amp;&amp;</span> <span class="nx">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">TeoriaChord</span><span class="p">(</span><span class="k">new</span> <span class="nx">TeoriaNote</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()),</span> <span class="nx">name</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">root</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid Chord. Couldn&#39;t find note name&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * teoria.frequency</span>
<span class="cm">   * </span>
<span class="cm">   * Frequence functionalty</span>
<span class="cm">   */</span>
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">frequency</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">note</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fq</span><span class="p">,</span> <span class="nx">concertPitch</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">concertPitch</span> <span class="o">=</span> <span class="nx">concertPitch</span> <span class="o">||</span> <span class="mi">440</span><span class="p">;</span>
        
        <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">octave</span><span class="p">,</span> <span class="nx">distance</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">cents</span><span class="p">,</span> <span class="nx">originalFq</span><span class="p">;</span>
        <span class="nx">key</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">49</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fq</span><span class="p">)</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">concertPitch</span><span class="p">))</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)));</span>
        <span class="nx">originalFq</span> <span class="o">=</span> <span class="nx">concertPitch</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="nx">key</span><span class="o">-</span><span class="mi">49</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">);</span>
        <span class="nx">cents</span> <span class="o">=</span> <span class="mi">1200</span> <span class="o">*</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fq</span><span class="o">/</span><span class="nx">originalFq</span><span class="p">)</span><span class="o">/</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
        <span class="nx">octave</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">key</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">);</span> <span class="c1">// Actually this is octave-1</span>
        <span class="nx">distance</span> <span class="o">=</span> <span class="nx">key</span> <span class="o">-</span> <span class="p">(</span><span class="nx">octave</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;</span>

        <span class="nx">note</span> <span class="o">=</span> <span class="nx">NOTES</span><span class="p">[</span><span class="nx">NOTES_INDEX</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">distance</span><span class="o">/</span><span class="mi">2</span><span class="p">)]];</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">note</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">distance</span> <span class="o">&lt;</span> <span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">name</span> <span class="o">+=</span> <span class="s1">&#39;#&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">distance</span> <span class="o">&gt;</span> <span class="nx">distance</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">name</span> <span class="o">+=</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="nx">note</span><span class="o">:</span> <span class="k">new</span> <span class="nx">TeoriaNote</span><span class="p">(</span><span class="nx">name</span><span class="o">+</span><span class="p">(</span><span class="nx">octave</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="nx">cents</span><span class="o">:</span> <span class="nx">cents</span><span class="p">};</span>
      <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * teoria.interval</span>
<span class="cm">   * </span>
<span class="cm">   * Sugar function for #from and #between methods, with the possibility to</span>
<span class="cm">   * declare a interval by its string name: P8, M3, m7 etc.</span>
<span class="cm">   * </span>
<span class="cm">   * @param from  teoria.note                     Must be an instance of teoria.note</span>
<span class="cm">   * @param to    [string | teoria.note] The to parameter</span>
<span class="cm">   */</span>
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">to</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;down&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">to</span> <span class="o">=</span> <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">invert</span><span class="p">(</span><span class="nx">to</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">quality</span> <span class="o">=</span> <span class="nx">QUALITY_STRING</span><span class="p">[</span><span class="nx">to</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
      <span class="kd">var</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">quality</span> <span class="o">||</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">interval</span><span class="p">)</span> <span class="o">||</span> <span class="nx">interval</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid string-interval format&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="p">{</span><span class="nx">quality</span><span class="o">:</span><span class="nx">quality</span><span class="p">,</span> <span class="nx">interval</span><span class="o">:</span><span class="nx">INTERVALS</span><span class="p">[</span><span class="nx">interval</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">name</span><span class="p">},</span> <span class="nx">direction</span><span class="p">);</span>    
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">to</span> <span class="k">instanceof</span> <span class="nx">TeoriaNote</span> <span class="o">&amp;&amp;</span> <span class="nx">from</span> <span class="k">instanceof</span> <span class="nx">TeoriaNote</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">between</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid parameters&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  
  <span class="cm">/**</span>
<span class="cm">   * Returns the note from a given note (from), with a given interval (to)</span>
<span class="cm">   */</span>
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">from</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">to</span><span class="p">.</span><span class="nx">direction</span> <span class="o">=</span> <span class="nx">direction</span> <span class="o">||</span> <span class="nx">to</span><span class="p">.</span><span class="nx">direction</span> <span class="o">||</span> <span class="s1">&#39;up&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">accDiff</span><span class="p">,</span> <span class="nx">diff</span><span class="p">,</span> <span class="nx">octave</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">interval</span><span class="p">;</span>
    <span class="nx">index</span> <span class="o">=</span> <span class="nx">INTERVAL_INDEX</span><span class="p">[</span><span class="nx">to</span><span class="p">.</span><span class="nx">interval</span><span class="p">];</span>
    <span class="nx">interval</span> <span class="o">=</span> <span class="nx">INTERVALS</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="nx">index</span> <span class="o">-=</span> <span class="mi">7</span><span class="p">;</span>
    
    <span class="nx">index</span> <span class="o">=</span> <span class="nx">NOTES</span><span class="p">[</span><span class="nx">from</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">index</span> <span class="o">+</span> <span class="nx">index</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="nx">NOTES_INDEX</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">-</span> <span class="nx">NOTES_INDEX</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="nx">note</span> <span class="o">=</span> <span class="nx">NOTES_INDEX</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">ALTERATIONS</span><span class="p">[</span><span class="nx">interval</span><span class="p">.</span><span class="nx">quality</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">quality</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nx">ALTERATIONS</span><span class="p">[</span><span class="nx">interval</span><span class="p">.</span><span class="nx">quality</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">interval</span><span class="p">.</span><span class="nx">quality</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid interval quality&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">accDiff</span> <span class="o">=</span> <span class="nx">ALTERATIONS</span><span class="p">[</span><span class="nx">interval</span><span class="p">.</span><span class="nx">quality</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">quality</span><span class="p">)</span><span class="o">-</span><span class="nx">ALTERATIONS</span><span class="p">[</span><span class="nx">interval</span><span class="p">.</span><span class="nx">quality</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">interval</span><span class="p">.</span><span class="nx">quality</span><span class="p">);</span>
    <span class="nx">diff</span> <span class="o">=</span> <span class="p">(</span><span class="nx">interval</span><span class="p">.</span><span class="nx">size</span><span class="o">+</span><span class="nx">accDiff</span><span class="p">)</span><span class="o">-</span><span class="nx">getDistance</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">note</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">octave</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">octave</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(((</span><span class="nx">from</span><span class="p">.</span><span class="nx">key</span><span class="p">()</span><span class="o">-</span><span class="nx">from</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="o">+</span><span class="nx">getDistance</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">note</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">INTERVAL_INDEX</span><span class="p">[</span><span class="nx">to</span><span class="p">.</span><span class="nx">interval</span><span class="p">]</span> <span class="o">/</span> <span class="mi">7</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">diff</span> <span class="o">+=</span> <span class="nx">from</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">diff</span> <span class="o">&gt;=</span> <span class="mi">11</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">diff</span> <span class="o">-=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">diff</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">diff</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">note</span> <span class="o">+=</span> <span class="nx">ACCIDENTALTOSIGN</span><span class="p">[</span><span class="nx">diff</span><span class="p">];</span>
    <span class="p">}</span>
    
    <span class="k">if</span><span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;down&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">octave</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="k">new</span> <span class="nx">TeoriaNote</span><span class="p">(</span><span class="nx">note</span> <span class="o">+</span> <span class="p">(</span><span class="nx">octave</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * Returns the interval between two instances of teoria.note</span>
<span class="cm">   */</span>
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">between</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fromKey</span> <span class="o">=</span> <span class="nx">from</span><span class="p">.</span><span class="nx">key</span><span class="p">(),</span> <span class="nx">toKey</span> <span class="o">=</span> <span class="nx">to</span><span class="p">.</span><span class="nx">key</span><span class="p">(),</span> <span class="nx">semitones</span><span class="p">,</span> <span class="nx">interval</span><span class="p">,</span> <span class="nx">intervalInt</span><span class="p">,</span> <span class="nx">tmp</span><span class="p">,</span> <span class="nx">simpleName</span><span class="p">,</span> <span class="nx">quality</span><span class="p">;</span>
    
    <span class="nx">semitones</span> <span class="o">=</span> <span class="nx">toKey</span> <span class="o">-</span> <span class="nx">fromKey</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">semitones</span> <span class="o">&gt;</span> <span class="mi">24</span> <span class="o">||</span> <span class="nx">semitones</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">25</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Too big interval. Highest interval is a augmented fifteenth (25 semitones)&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">semitones</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">from</span><span class="p">;</span>
      <span class="nx">from</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
      <span class="nx">to</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">intervalInt</span> <span class="o">=</span> <span class="nx">NOTES</span><span class="p">[</span><span class="nx">to</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">index</span> <span class="o">-</span> <span class="nx">NOTES</span><span class="p">[</span><span class="nx">from</span><span class="p">.</span><span class="nx">name</span><span class="p">].</span><span class="nx">index</span> <span class="o">+</span> <span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">octave</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">octave</span><span class="p">));</span>
    <span class="nx">interval</span> <span class="o">=</span> <span class="nx">INTERVALS</span><span class="p">[</span><span class="nx">intervalInt</span><span class="p">];</span>
    <span class="nx">quality</span> <span class="o">=</span> <span class="nx">ALTERATIONS</span><span class="p">[</span><span class="nx">interval</span><span class="p">.</span><span class="nx">quality</span><span class="p">][</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">semitones</span><span class="p">)</span><span class="o">-</span><span class="nx">interval</span><span class="p">.</span><span class="nx">size</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="nx">simpleName</span> <span class="o">=</span> <span class="nx">QUALITY_TO_SIMPLE</span><span class="p">[</span><span class="nx">quality</span><span class="p">]</span> <span class="o">+</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">intervalInt</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="nx">interval</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">quality</span><span class="o">:</span> <span class="nx">quality</span><span class="p">,</span> <span class="nx">direction</span><span class="o">:</span> <span class="p">(</span><span class="nx">semitones</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;up&#39;</span> <span class="o">:</span> <span class="s1">&#39;down&#39;</span><span class="p">),</span> <span class="nx">simple</span><span class="o">:</span> <span class="nx">simpleName</span><span class="p">};</span>
  <span class="p">};</span>
  
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">.</span><span class="nx">invert</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sInterval</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">sInterval</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">sInterval</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nx">quality</span> <span class="o">=</span> <span class="nx">INTERVAL_INVERSION</span><span class="p">[</span><span class="nx">sInterval</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
    <span class="kd">var</span> <span class="nx">inverse</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sInterval</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">sInterval</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">sInterval</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">inverse</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inverse</span> <span class="o">=</span> <span class="nx">inverse</span> <span class="o">-</span> <span class="mi">7</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">inverse</span> <span class="o">!==</span> <span class="mi">8</span> <span class="o">&amp;&amp;</span> <span class="nx">inverse</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inverse</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">-</span> <span class="nx">inverse</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">quality</span> <span class="o">+</span> <span class="nx">inverse</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * teoria.scale namespace.</span>
<span class="cm">   * This object contains functionality with scales.</span>
<span class="cm">   */</span>
  <span class="nx">teoria</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * List a given scale in either teoria.note&#39;s or plain strings</span>
<span class="cm">     */</span>
    <span class="nx">list</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">simple</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">notes</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">sNotes</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">length</span><span class="p">;</span>
      
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">root</span> <span class="k">instanceof</span> <span class="nx">TeoriaNote</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
        
      <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">scale</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">scale</span> <span class="o">=</span> <span class="nx">teoria</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">scales</span><span class="p">[</span><span class="nx">scale</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">scale</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">root</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">simple</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sNotes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="p">(</span><span class="nx">root</span><span class="p">.</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
      <span class="p">}</span>
      
      <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">scale</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">notes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">teoria</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">scale</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">simple</span> <span class="o">&amp;&amp;</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">sNotes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="p">(</span><span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nx">accidental</span><span class="p">.</span><span class="nx">sign</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="p">(</span><span class="nx">simple</span><span class="p">)</span> <span class="o">?</span> <span class="nx">sNotes</span> <span class="o">:</span> <span class="nx">notes</span><span class="p">;</span>
    <span class="p">},</span>
    
    <span class="cm">/**</span>
<span class="cm">     * A list of scales, used internally in the #list function.</span>
<span class="cm">     * Scales are written in interval format. (M2 = Major second, m2 = Minor second, etc.)</span>
<span class="cm">     * Note that the root note is not listed.</span>
<span class="cm">     */</span>
    <span class="nx">scales</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">major</span><span class="o">:</span>      <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        <span class="nx">ionian</span><span class="o">:</span>     <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        <span class="nx">dorian</span><span class="o">:</span>     <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">],</span>
        <span class="nx">phrygian</span><span class="o">:</span>   <span class="p">[</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        <span class="nx">lydian</span><span class="o">:</span>     <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        <span class="nx">mixolydian</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">],</span>
        <span class="nx">minor</span><span class="o">:</span>      <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        <span class="nx">aeolian</span><span class="o">:</span>    <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        <span class="nx">locrian</span><span class="o">:</span>    <span class="p">[</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        
        <span class="nx">majorpentatonic</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">],</span>
        <span class="nx">minorpentatonic</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;m3&#39;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nb">window</span><span class="p">.</span><span class="nx">teoria</span> <span class="o">=</span> <span class="nx">teoria</span><span class="p">;</span>
<span class="p">}());</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 