var scope=typeof exports=="object"?exports:window;(function(t){"use strict";function b(e,t){return e=r[e],t=r[t],e.distance>t.distance?t.distance+12-e.distance:t.distance-e.distance}function w(e,t,n){for(;n>0;n--)e+=t;return e}function E(e,t){if(typeof e!="string")return null;t=t||{},this.name=e,this.duration={value:t.value||4,dots:t.dots||0},this.accidental={value:0,sign:""};var n=/^([a-h])(x|#|bb|b?)(-?\d*)/i,r=/^([a-h])(x|#|bb|b?)([,\']*)$/i,i,s,o,u,a=e.match(n);if(a&&e===a[0]&&a[3].length!==0)o=a[1].toLowerCase(),u=parseInt(a[3],10),a[2].length>0&&(i=a[2].toLowerCase(),s=m[a[2]]);else{e=e.replace(/\u2032/g,"'").replace(/\u0375/g,","),a=e.match(r);if(!a||e!==a[0])throw new Error("Invalid note format");o=a[1],u=a[3],a[2].length>0&&(i=a[2].toLowerCase(),s=m[a[2]]);if(u.length===0)u=o===o.toLowerCase()?3:2;else if(u.match(/^'+$/)){if(o===o.toUpperCase())throw new Error("Format must respect the Helmholtz notation");u=3+u.length}else{if(!u.match(/^,+$/))throw new Error("Invalid characters after note name.");if(o===o.toLowerCase())throw new Error("Format must respect the Helmholtz notation");u=2-u.length}}this.name=o.toLowerCase(),this.octave=u,i&&(this.accidental.value=s,this.accidental.sign=i)}function S(e,t,n){var r=e>=8&&e%7===1?e%7*8:(e-1)%7+1,i=Math.ceil((e-r)/8),s=o[r-1];if(!(t in l[s.quality]))throw new Error("Invalid interval quality");this.interval=e,this.quality=t,this.direction=n==="down"?"down":"up",this.simpleInterval=r,this.simpleIntervalType=s,this.compoundOctaves=i}function x(e,t){if(!(e instanceof E))return null;t=t||"",this.name=e.name.toUpperCase()+e.accidental.sign+t,this.symbol=t,this.root=e,this.notes=[e],this.quality="major";var r,i,s,o,u,f="quality",l=["M3","P5","m7","M9","P11","M13"],c=2,h=[],d,v;t=t.replace(/[,\s\(\)]/g,""),d=t.split("/"),d.length===2?(t=d[0],d=d[1]):d=null;for(r=0,i=t.length;r<i;r++){s=t[r];if(!s)break;o=s.charCodeAt(r),u=r+3<=i?t.substr(r,3):null;switch(f){case"quality":var m;u&&a[u]?(m=p[a[u]],this.quality=a[u],r+=u.length-1):a[s]&&u!=="maj"?(m=p[a[s]],this.quality=a[s]):(m=p.major,r-=1),l[0]=m[0],l[1]=m[1],f="extension";break;case"extension":s=s==="1"&&t[r+1]?parseFloat(t.substr(r,2)):parseFloat(s);if(!isNaN(s)&&s!==6){c=(s-1)/2;if(c!==Math.round(c))throw new Error("Invalid interval extension: "+s.toString(10));r+=String(s).length-1}else s===6?(l[2]="M6",c<3&&(c=3)):r-=1;f="alterations";break;case"alterations":var g=t.substr(r).split(/(#|b|add|maj|sus)/),y,b=!1,w=!1;if(g.length===1)throw new Error("Invalid alterations");if(g[0].length!==0)throw new Error("Invalid token: '"+g[0]+"'");for(var S=1,x=g.length;S<x;S++){y=x>S+1?g[S+1]:null;switch(g[S]){case"maj":c<3&&(c=3),y==="7"&&S++,l[2]="M7";break;case"sus":var T="P4";if(y==="2"||y==="4")y==="2"&&(T="M2"),S++;l[0]=T;break;case"add":y&&!isNaN(parseFloat(y))&&(y==="9"?h.push("M9"):y==="11"?h.push("P11"):y==="13"&&h.push("M13"),S+=y.length);break;case"b":b=!0;break;case"#":w=!0;break;default:if(g[S].length===0)break;var N=parseFloat(g[S]),C,k=parseFloat(g[S]),L;if(isNaN(N)||String(N).length!==g[S].length)throw new Error("Invalid token: '"+g[S]+"'");if(N===6){w?l[2]="A6":b?l[2]="m6":l[2]="M6",c<3&&(c=3);continue}L=(k-1)/2-1,c<L+1&&(c=L+1);if(k<5||k===7||L!==Math.round(L))throw new Error("Invalid interval alteration: "+k.toString(10));C=l[L][0];if(w){if(C==="d")C="m";else if(C==="m")C="M";else if(C==="M"||C==="P")C="A"}else if(b)if(C==="A")C="M";else if(C==="M")C="m";else if(C==="m"||C==="P")C="d";l[L]=C+l[L].substr(1)}}f="ended"}if(f==="ended")break}l=l.slice(0,c).concat(h);if(d){d=n.note(d);var A=n.interval.between(e,d);d.octave-=A.direction==="up"?1:0,this.notes.splice(0,0,d)}for(r=0;r<l.length;r++){v=this.root.interval(l[r]);if(d&&v.toString(!0)===d.toString(!0))continue;this.notes.push(v)}}function T(e,t){var r,i,s;if(!(e instanceof E))throw new Error("Invalid Tonic");if(typeof t=="string"){r=t,t=n.scale.scales[t];if(!t)throw new Error("Invalid Scale")}else for(i in n.scale.scales)if(n.scale.scales.hasOwnProperty(i)&&n.scale.scales[i].toString()===t.toString()){r=i;break}this.name=r,this.notes=[],this.tonic=e,this.scale=t;for(i=0,s=t.length;i<s;i++)this.notes.push(n.interval(e,t[i]))}var n={},r={c:{name:"c",distance:0,index:0},d:{name:"d",distance:2,index:1},e:{name:"e",distance:4,index:2},f:{name:"f",distance:5,index:3},g:{name:"g",distance:7,index:4},a:{name:"a",distance:9,index:5},b:{name:"b",distance:11,index:6},h:{name:"h",distance:11,index:6}},i=["c","d","e","f","g","a","b"],s={.25:"longa",.5:"breve",1:"whole",2:"half",4:"quarter",8:"eighth",16:"sixteenth",32:"thirty-second",64:"sixty-fourth",128:"hundred-twenty-eighth"},o=[{name:"first",quality:"perfect",size:0},{name:"second",quality:"minor",size:1},{name:"third",quality:"minor",size:3},{name:"fourth",quality:"perfect",size:5},{name:"fifth",quality:"perfect",size:7},{name:"sixth",quality:"minor",size:8},{name:"seventh",quality:"minor",size:10},{name:"octave",quality:"perfect",size:12}],u={first:0,second:1,third:2,fourth:3,fifth:4,sixth:5,seventh:6,octave:7,ninth:8,tenth:9,eleventh:10,twelfth:11,thirteenth:12,fourteenth:13,fifteenth:14},a={P:"perfect",M:"major",m:"minor","-":"minor",A:"augmented","+":"augmented",AA:"doubly augmented",d:"diminished",dd:"doubly diminished",aug:"augmented",dim:"diminished"},f={perfect:"P",major:"M",minor:"m",augmented:"A","doubly augmented":"AA",diminished:"d","doubly diminished":"dd"},l={perfect:{"doubly diminished":-2,diminished:-1,perfect:0,augmented:1,"doubly augmented":2},minor:{"doubly diminished":-2,diminished:-1,minor:0,major:1,augmented:2,"doubly augmented":3}},c={perfect:"perfect",major:"minor",minor:"major",augmented:"diminished","doubly augmented":"doubly diminished",diminished:"augmented","doubly diminished":"doubly augmented"},h={perfect:["doubly diminished","diminished","perfect","augmented","doubly augmented"],minor:["doubly diminished","diminished","minor","major","augmented","doubly augmented"]},p={major:["M3","P5"],minor:["m3","P5"],augmented:["M3","A5"],diminished:["m3","d5"],sus2:["M2","P5"],sus4:["P4","P5"],power:["P5"]},d={major:"M",minor:"m",augmented:"aug",diminished:"dim",power:"5"},v={"-2":"bb","-1":"b",0:"",1:"#",2:"x"},m={bb:-2,b:-1,"#":1,x:2},g={first:"1",tonic:"1",second:"2",third:"3",fourth:"4",fifth:"5",sixth:"6",seventh:"7",ninth:"9",eleventh:"11",thirteenth:"13"},y={dd1:"daw",d1:"de",P1:"do",A1:"di",AA1:"dai",d2:"raw",m2:"ra",M2:"re",A2:"ri",AA2:"rai",d3:"maw",m3:"me",M3:"mi",A3:"mai",dd4:"faw",d4:"fe",P4:"fa",A4:"fi",AA4:"fai",dd5:"saw",d5:"se",P5:"so",A5:"si",AA5:"sai",d6:"law",m6:"le",M6:"la",A6:"li",AA6:"lai",d7:"taw",m7:"te",M7:"ti",A7:"tai",dd8:"daw",d8:"de",P8:"do",A8:"di",AA8:"dai"};E.prototype={key:function(e){var t;return e?(t=Math.ceil(r[this.name].distance/2),(this.octave-1)*7+3+t):(t=r[this.name].distance+this.accidental.value,(this.octave-1)*12+4+t)},fq:function(e){return e=e||440,e*Math.pow(2,(this.key()-49)/12)},scale:function(e){return n.scale(this,e)},interval:function(e,t){return n.interval(this,e,t)},transpose:function(e,t){var r=n.interval(this,e,t);return this.name=r.name,this.octave=r.octave,this.accidental=r.accidental,this},chord:function(e){return e=e||"major",e in d&&(e=d[e]),new x(this,e)},helmholtz:function(){var e=this.octave<3?this.name.toUpperCase():this.name.toLowerCase(),t=this.octave<3?",":"'",n=this.octave<2?2-this.octave:this.octave-3;return w(e+this.accidental.sign,t,n),w(e+this.accidental.sign,t,n)},scientific:function(){var e=typeof this.octave=="number"?this.octave:"";return this.name.toUpperCase()+this.accidental.sign+e},enharmonics:function(){var e=[],t=this.key(),n=this.interval("m2","up"),r=this.interval("m2","down"),i=n.key()-n.accidental.value,s=r.key()-r.accidental.value,o=t-i;return o<3&&o>-3&&(n.accidental={value:o,sign:v[o]},e.push(n)),o=t-s,o<3&&o>-3&&(r.accidental={value:o,sign:v[o]},e.push(r)),e},solfege:function(e,t){if(e instanceof T){var n=e.tonic.interval(this),r,i,s;return n.direction==="down"&&(n=n.invert()),t&&(s=(this.key(!0)-e.tonic.key(!0))/7,s=s>=0?Math.floor(s):-Math.ceil(-s),i=s>=0?"'":","),r=y[n.simple()],t?w(r,i,Math.abs(s)):r}throw new Error("Invalid Scale")},durationName:function(){return s[this.duration.value]},durationInSeconds:function(e,t){var n=60/e/(this.duration.value/4)/(t/4);return n*2-n/Math.pow(2,this.duration.dots)},scaleDegree:function(e){var t=e.tonic.interval(this);return t=t.direction==="down"||t.simpleInterval===8?t.invert():t,e.scale.indexOf(t.simple())+1},toString:function(e){var t=e?"":this.octave;return this.name.toLowerCase()+this.accidental.sign+t}},S.prototype={semitones:function(){return this.simpleIntervalType.size+this.qualityValue()+this.compoundOctaves*12},simple:function(){return f[this.quality]+this.simpleInterval.toString()},compound:function(){return f[this.quality]+(this.simpleInterval+this.compoundOctaves*7).toString()},isCompound:function(){return this.compoundOctaves>0},invert:function(){var e=this.simpleInterval;return e=9-e,new S(e,c[this.quality])},qualityValue:function(){var e=this.simpleIntervalType.quality,t=this.quality;return l[e][t]},equal:function(e){return this.interval===e.interval&&this.quality===e.quality},greater:function(e){var t=this.semitones(),n=e.semitones();return t===n?this.interval>e.interval:t>n},smaller:function(e){return!this.equal(e)&&!this.greater(e)},toString:function(){return this.compoundOctaves>0?this.compound():this.simple()}},x.prototype={dominant:function(e){return e=e||"",new x(this.root.interval("P5"),e)},subdominant:function(e){return e=e||"",new x(this.root.interval("P4"),e)},parallel:function(e){e=e||"";if(this.chordType()!=="triad"||this.quality==="diminished"||this.quality==="augmented")throw new Error("Only major/minor triads have parallel chords");return this.quality==="major"?new x(this.root.interval("m3","down"),"m"):new x(this.root.interval("m3","up"))},chordType:function(){var e=this.notes.length,t,n,r,i,s;if(e===2)return"dyad";if(e===3){n={first:!1,third:!1,fifth:!1};for(i=0;i<e;i++)t=this.root.interval(this.notes[i]),r=t.invert(),t.simpleIntervalType.name in n?n[t.simpleIntervalType.name]=!0:r.simpleIntervalType.name in n&&(n[r.simpleIntervalType.name]=!0);s=n.first&&n.third&&n.fifth?"triad":"trichord"}else if(e===4){n={first:!1,third:!1,fifth:!1,seventh:!1};for(i=0;i<e;i++)t=this.root.interval(this.notes[i]),r=t.invert(),t.simpleIntervalType.name in n?n[t.simpleIntervalType.name]=!0:r.simpleIntervalType.name in n&&(n[r.simpleIntervalType.name]=!0);n.first&&n.third&&n.fifth&&n.seventh&&(s="tetrad")}return s||"unknown"},get:function(e){if(typeof e=="string"&&e in g){var t=o[u[e]].quality;t=t==="perfect"?"P":"M",e=this.root.interval(t+g[e]);for(var n=0,r=this.notes.length;n<r;n++)if(this.notes[n].name===e.name)return this.notes[n];return null}throw new Error("Invalid interval name")},interval:function(e,t){return new x(this.root.interval(e,t),this.symbol)},transpose:function(e,t){var n=new x(this.root.interval(e,t),this.symbol);return this.name=n.name,this.symbol=n.symbol,this.root=n.root,this.notes=n.notes,this.quality=n.quality,this},toString:function(){return this.name}},T.prototype={simple:function(){var e=[];for(var t=0,n=this.notes.length;t<n;t++)e.push(this.notes[t].toString(!0));return e},type:function(){var e=null,t=this.notes.length;return t===2?e="ditonic":t===3?e="tritonic":t===4?e="tetratonic":t===5?e="pentatonic":t===6?e="hexatonic":t===7?e="heptatonic":t===8&&(e="octatonic"),e},get:function(e){if(typeof e=="number")return e>0&&e<=this.notes.length?this.notes[e-1]:null;if(typeof e=="string"&&e in g)return e=parseFloat(g[e]),e>0&&e<=this.notes.length?this.notes[e-1]:null},solfege:function(e,t){var n,r,i=[];if(e)return this.get(e).solfege(this,t);for(n=0,r=this.notes.length;n<r;n++)i.push(this.notes[n].solfege(this,t));return i},interval:function(e,t){return new T(this.tonic.interval(e,t),this.scale)},transpose:function(e,t){var n=new T(this.tonic.interval(e,t),this.scale);return this.notes=n.notes,this.scale=n.scale,this.tonic=n.tonic,this}},n.note=function(e,t){return new E(e,t)},n.note.fromKey=function(e){var t=Math.floor((e-4)/12),s=e-t*12-4,o=r[i[Math.round(s/2)]],u=o.name;return o.distance<s?u+="#":o.distance>s&&(u+="b"),n.note(u+(t+1).toString(10))},n.note.fromFrequency=function(e,t){var r,i,s;return t=t||440,r=49+12*((Math.log(e)-Math.log(t))/Math.log(2)),r=Math.round(r),s=t*Math.pow(2,(r-49)/12),i=1200*(Math.log(e/s)/Math.log(2)),{note:n.note.fromKey(r),cents:i}},n.note.fromMIDI=function(e){return n.note.fromKey(e-20)},n.chord=function(e,t){if(typeof e=="string"){var r,i;r=e.match(/^([a-h])(x|#|bb|b?)/i);if(r&&r[0])return i=typeof t=="number"?t.toString(10):"4",new x(n.note(r[0].toLowerCase()+i),e.substr(r[0].length))}else if(e instanceof E)return new x(e,t||"");throw new Error("Invalid Chord. Couldn't find note name")},n.interval=function(e,t,r){var i,s,o,u=/^(AA|A|P|M|m|d|dd)(\d+)$/;if(typeof e=="string"){u=e.match(u);if(!u)throw new Error("Invalid string-interval format");return i=a[u[1]],s=parseInt(u[2],10),new S(s,i,r)}if(typeof t=="string"&&e instanceof E){r==="down"&&(t=n.interval.invert(t)),u=t.match(u);if(!u)throw new Error("Invalid string-interval format");return i=a[u[1]],s=parseInt(u[2],10),o=new S(s,i,r),n.interval.from(e,o)}if(t instanceof E&&e instanceof E)return n.interval.between(e,t);throw new Error("Invalid parameters")},n.interval.from=function(e,t){var s,o,u,a,f;return a=t.simpleInterval-1,a=r[e.name].index+a,a>i.length-1&&(a-=i.length),s=i[a],f=b(e.name,s),o=t.simpleIntervalType.size+t.qualityValue()-f,u=Math.floor((e.key()-e.accidental.value+f-4)/12),u+=1+Math.floor((t.simpleInterval-1)/7),u+=t.compoundOctaves,o+=e.accidental.value,o>=10&&(o-=12),s+=v[o],t.direction==="down"&&u--,n.note(s+u.toString(10))},n.interval.between=function(e,t){var n=e.key(),i=t.key(),s,u,a,f,l,c,p="up",d;s=i-n,a=r[t.name].index-r[e.name].index+7*(t.octave-e.octave);if(s<0||a<0)a=-a,p="down",f=e,e=t,t=f;return a+=1,d=a>=8&&a%7===1?a%7*8:(a-1)%7+1,u=o[d-1],c=h[u.quality],l=c[(Math.abs(s)-u.size+2)%12],new S(a,l,p)},n.interval.invert=function(e){return n.interval(e).invert().toString()},n.scale=function(e,t){return e instanceof E||(e=n.note(e)),new T(e,t)},n.scale.scales={major:["P1","M2","M3","P4","P5","M6","M7"],ionian:["P1","M2","M3","P4","P5","M6","M7"],dorian:["P1","M2","m3","P4","P5","M6","m7"],phrygian:["P1","m2","m3","P4","P5","m6","m7"],lydian:["P1","M2","M3","A4","P5","M6","M7"],mixolydian:["P1","M2","M3","P4","P5","M6","m7"],minor:["P1","M2","m3","P4","P5","m6","m7"],aeolian:["P1","M2","m3","P4","P5","m6","m7"],locrian:["P1","m2","m3","P4","d5","m6","m7"],majorpentatonic:["P1","M2","M3","P5","M6"],minorpentatonic:["P1","m3","P4","P5","m7"],chromatic:["P1","m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"],harmonicchromatic:["P1","m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"]},n.TeoriaNote=E,n.TeoriaChord=x,n.TeoriaScale=T,n.TeoriaInterval=S,t.teoria=n})(scope)